<?xml version='1.0' encoding='UTF-8'?>

<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" []>
<chapter>
  <title>Tablas dinámicas y la herramienta MyDatamart</title>
  <para>La tabla dinámica Excel (véase la imagen de pantalla a continuación) es una potente y dinámica herramienta de análisis que podemos enlazar automáticamente con los datos en DHIS 2. Mientras la mayoría de herramientas de reporte en DHIS 2 están limitadas en cuántos datos pueden presentar a la vez, las tablas dinámicas están diseñadas para mostrar buenas vistas con múltiples elementos de datos o indicadores, y unidades organizativas y periods (véase el ejemplo abajo). Es más, las características dinámicas de pitovar y examinar a fondo son muy distintas de las de hojas de datos estáticas o reportes web, y esto las convierte en una herramienta muy útil a los usuarios de información que quieren hacer análisis más profundos y manejar las vistas de los datos de forma más dinámica. Combinando esto con las conocidas capacidades gráficas de Excel, la herramienta de tablas dinámicas se ha convertido por mucho tiempo en una herramienta de análisis muy popular entre los usuarios más avanzados de DHIS.</para>
  <graphic width="100%" format="PNG" fileref="resources/images/implementation_guide/pivot_table.png" align="center"/>
  <para>Con el cambio reciente hacia despliegues online, las tablas dinámicas offline en Excel también son una alternativa útil a las herramientas de reporte online, ya que permiten el análisis local de los datos sin conexión a Internet, lo que puede ser una ventaja en conexiones inestables o costosas. Así, Internet solo es necesario para descargar nuevos datos del servidor online, y tan pronto como los datos estén en local, trabajar con tablas dinámicas no requiere conexión. La herramienta MyDatamart, que se explica en detalle más abajo, ayuda a los usuarios a mantener un fichero local de datos (una pequeña base de datos) que se actualiza por Internet contra el servidor online, y que entonces puede usarse como fuente de datos offline para cargar datos a las tablas dinámicas.</para>
  <section>
    <title>Diseño de tablas dinámicas</title>
    <para>Normalmente un fichero de tabla dinámica Excel configurado para DHIS 2 contiene múltiples hojas de trabajo con una tabla dinámica por página. Una tabla puede estar formada por valores de datos en bruto (elementos de datos) o valores de indicadores, y generalmente se nombrará según el nivel de la jerarquía de unidades organizativas en el que están agregados los datos fuente, así como el tipo de periodo (frecuencia, por ejemplo mensual, anual) de los datos. Un fichero de tablas dinámicas estándar en DHIS 2 incluye las siguientes tablas dinámicas: indicadores distritales, datos distritales mensuales, datos distritales anuales, indicadores por establecimiento, datos mensuales por establecimiento, datos anuales por establecimiento. Además puede haber más tablas especializadas que se enfocan en programas específicos y/o en otros tipos de periodos.</para>
    <para>Una caractarerística bien popular de las tablas de datos es la capacidad para arrastrar y mover los campos entre las tres páginas/filtros de posiciones, filas y columnas, y así cambiar totalmente la vista de los datos. Podemos ver estos datos como dimensiones de los valores de datos y representar las dimensiones en el modelo de datos DHIS; unidad organizativa (un campo por nivel), elementos de datos o indicadores, periodos, y también listados extendidos dinámicamente de dimensiones adicionales que representan sets de grupos de unidades organizativas/indicatores/elementos de datos y categorías de elementos de datos (véase otros capítulos de esta guía para más detalle). De hecho una tabla dinámica es yna herramienta excelente para representar las muchas dimensiones creadas en DHIS 2, y facilita enormemente acercarnos o alejarnos de cada dimensión, por ejemplo mirar a valores de datos en bruto por grupos individuales de edad o simplemente por sus totales, o en combinación con otras dimensiones como género. Todas las dimensiones creadas en DHIs 2 se reflejarán en la lista de campos disponibles de cada tabla dinámica, y entonces está en mano del usuairo seleccionar con cuáles quiere trabajar. </para>
    <para>Es importante entender que los valores en las tablas dinámicas no son editables y que todos los nombres y números se cargan directamente desde la base de datos de DHIS 2, lo cual se diferencia de una hoja de cálculo normal. Para poder editarlos, tendremos que copiar los contenidos de una tabla dinámica en una hoja de cálculo normal, pero esto rara vez es necesario ya que todos los nombres pueden editarse en DHIs 2 (y por tanto reflejarse en la tabla dinámica en la siguiente actualización). Los nombres (etiquetas) de cada campo sin embargo son editables, pero no sus contenidos (valores).</para>
  </section>
  <section>
    <title>Conectando con la base de datos de DHIS 2</title>
    <para>Cada tabla dinámica tiene una conexión con la base de datos de DHIS 2 y utiliza una fuente dinámica (petición SQL) en la base de datos para hacerse con los datos. Estas peticiones jalan todos los datos de las tablas datamart, de modo que es importante tener el datamart actualizado todo el tiempo para cargar los datos más recientes en las tablas dinámicas. Una tabla dinámica puede conectarse a la base de datos de la computadora local o de un servidor remoto. Esto lo hace muy apropiado para una red local donde hay solo una base de datos compartida y múltiples computadoras cliente utilizando tablas dinámicas. Excel también puede conectarse a bases de datos sobre Linux. La conexión con la base de datos utilizada en las tablas dinámicas se especifica en una fuente de datos ODBC en las computadoras Windows que ejecutan tablas dinámicas.</para>
    <para>En despliegues online recomendamos que la conexión a los datos de DHIS 2 se haga utilizando la herramienta MyDatamart, que crea y actualiza un fichero de datos local (base de datos) a la que Excel puede conectarse. La herramienta MyDatamart se detalla a continuación.</para>
  </section>
  <section>
    <title>Manejando grandes cantidades de datos</title>
    <para>La cantidad de datos en una base de datos de DHIS 2 puede sobrepasar fácilmente las capacidades de Excel. una tabla con cerca de un millón de valores (filas de datos) tiende a reaccionar peor ante actualizaciones (refresco) y operaciones dinámicas, y en algunas computadoras Excel dará errores de memoria al manear tablas de estos tamaños. Normalmente, cuanto más potente sea la computadora, más datos puede manejar, pero la cota superior parece estar en torno a un millón de filas incluso en las computadoras más modernas.</para>
    <para>Para afrontar este problema la configuración estándar de tablas dinámicas en DHIS divide los datos en muchas tablas dinámicas. Hay diferentes formas de dividir los datos: por nivel de agregación de unidad organizativa (según profundidad), por cobertura o área limítrofe de unidad organizativa (según extensión), por periodo (por ejemplo un año de datos de una vez), o por grupos de elementos de datos o de indicadores (por ejemplo por programas o temas de salud). La aproximación más eficiente es agregar por el menor nivel en la jerarquía de unidades organizativas, ya que reduce la cantidad de data por el factor del número de establecimientos de salud en un país. Normalmente no hay necesidad de mirar en todos los establecimientos de salud de un país al mismo tiempo, sino solo en un área limitada (un municipio o provincia). Y cuando hay la necesidad de datos de todo el país, éstos pueden darse con agregados por distrito o similar. En una oficina de distrito o provincia los usuarios generalmente tendrán datos de nivel de establecimiento de salud solo para su propio área, y entonces para las áreas colindantes se agregarán uno o dos niveles para reducir el tamaño de los datos, pero todavía permitiendo la comparación, divididos por ejemplo en dos tablas: datos de establecimiento y datos de distrito, y similares para los valores de indicadores. Dividir los datos por periodo o por grupos de elementos de datos o indicadores funciona más o menos de la misma manera, y podemos hacerlo en combinación con la división por unidades organizativas o en lugar de ésta. Por ejemplo, es posible analizar para un programa de salud concreto unos pocos elementos de datos a nivel de establecimiento de salud para todo el país. Esta división se controla mediante las vistas dinámicas en la base de datos donde especificamos qué valores de datos usar.</para>
  </section>
  <section>
    <title>La herramienta MyDatamart</title>
    <para>Al utilizar despliegues online y un solo servidor central (y base de datos) el uso local de tablas dinámicas se hace más difícil, ya que Excel conecta directamente a la base de datos para buscar los datos. Esto significa que Excel (y cualquier computadora que utilice DHIS2) necesitaría detalles de conexión y acceso a la base de datos en el servidor, lo cual no siempre queremos. Es más, la operación de refresco (actualización de la tabla dinámica) en Excel vacía completamente la tabla antes de recargar todos los datos de nuevo (los viejos y los nuevos), lo que conlleva descargas grandes y con duplicados a través de Internet siempre que conectemos con el servidor online. La solución a estos problemas ha sido montar y mantener una &quot;copia&quot; actualizada de la base de datos central en cada oficina local donde utilicen tablasd dinámicas Excel. Estas bases de datos locales se llaman datamarts y se montan específicamente para hacer de fuentes de datos para herramientas de análisis de datos como Excel. La herramienta MyDatamart es una aplicación de reciente desarrollo (mayo de 2011) que crea un fichero de datamart en una computadora local y ayuda a los usuarios a actualizarla contra el servidor central. Las tablas dinámicas en Excel conectan solo con el datamart local y no necesitan saber nada acerca del servidor central.</para>
    <para>La utilización de MyDatamart reduce dramáticamente el tamaño de descargas cuando necesitamos actualizar de forma rutinaria los ficheros locales Excel contra el servidor central, en comparación con una conexión directa desde Excel. También hace que los usuarios locales se sientan más cómodos teniendo una copia de sus datos en su computadora local y no dependan de una conexión a Internet o del estado del servidor central para accederlos. La figura siguiente muestra el diagrama de flujo del datamart.</para>
    <graphic width="100%" format="PNG" fileref="resources/images/implementation_guide/mydatamart.png" align="center"/>
  </section>
  <section>
    <title>Utilizando tablas dinámicas Excel y MyDatamart - un ejemplo práctico</title>
    <para>Los detalles de utilización de la herramienta MyDatamart se explican en un manual de usuario a parte, y esta sección solo pretende explicar el típico diagrama de flujo que tenemos al usar la herramienta junto con las tablas dinámicas.</para>
    <section>
      <title>Descargar y lanzar la herramienta MyDatamart por primera vez</title>
      <para>MyDatamart es una herramienta pequeña fácil de descargar y ejecutar de inmediato. Descargaremos mydatamart.exe en el Escritorio y lo ejecutaremos haciendo doble click en el fichero. Lo primero que necesitamos es crear un nuevo fichero datamart, y luego tipear los detalles de login necesarios para acceder al servidor central (UTL, nombre de usuario, contraseña). La herramienta se conectará al servidor (en este punto necesitamos la conexión a Internet) y verificará la información de autenticación. El siguiente paso es descargar todos los metadatos del servidor, es decir unidades organizativas, elementos de datos, indicadores, grupos, etc. Esto puede demorarse un tiempo dependiendo de las especificaciones técnicas de la computadora local y de la velocidad de la conexión, pero es un paso que rara vez necesitaremos repetir después de esta primera descarga. Una vez que la herramienta conoce la jerarquía de unidades organizativas podemos especificar a qué unidad organizativa &quot;pertenecemos&quot; y el nivel de análisis que nos interesa. Estos son los parámetros de configuración que limitarán la información de qué unidades organizativas descargaremos. Lo siguiente es descargar los datos del servidor, y especificar qué periodos descargar.</para>
    </section>
    <section>
      <title>Crear y distribuir las tablas dinámicas</title>
      <para>Lo primero que necesitamos es descargar e instalar un driver (controlador) ODBC para SQLite, que es el servidor de base de datos que ejecuta el datamart local. Las conexiones a la base de datos de las tablas dinámicas dependerán de este driver y fallarán si no lo instalamos.</para>
      <para>El siguiente paso es crear las tablas dinámicas. Esta es una tarea única, ya que el fichero podrá luego reutilizarse como plantilla en otras ubicaciones que se conecten a la misma base de datos central. La herramienta MyDatamart puede producir un fichero Excel plantilla que tenga definidas todas las conexiones necesarias a la base de datos. Esto ayudará enormemente en el proceso y buena parte del trabajo aquí está en seleccionar qué campos usar en qué tabla y darle nombres apropiados. El manual de usuario tiene instrucciones detalladas sobre cómo crear una tabla dinámica usando conexiones MyDatamart.</para>
      <para>Una vez que el fichero plantilla de Excel está disponible es cuestión de distribuirlo en todas las oficinas locales que utilizarán tablas dinámicas y asegurarnos de que las conexiones definidas son válidas en todas esas computadoras locales. Los detalles de conexión en Excel dependen de que el driver ODBC esté disponible y del nombre y ubicación del fichero datamart. Podemos unificar todos los ficheros locales datamart (por nombre y ubicación, por ejemplo: &quot;C:\dhis2\dhis2.dmart&quot;), o podemos usar la herramienta MyDatamart para actualizar los detalles de conexión en un fichero Excel existente para que encaje con la ubicación del fichero local datamart.</para>
    </section>
    <section>
      <title>Actualizar MyDatamart</title>
      <para>Siempre que haya nuevos datos disponibles en el servidor central, por ejemplo, cada mes, los usuarios tendrán que abrir la herramienta MyDatamart, loguearse en el servidor, y seleccionar los meses para descargar. Una vez que la descarga ha terminado los datos están disponibles localmente en el fichero datamart.</para>
    </section>
    <section>
      <title>Actualizar las tablas dinámicas</title>
      <para>Cuando el fichero datamart se ha actualizado, los usuarios pueden actualizar las tablas dinámicas utilizando la función Refresco, una vez por cada tabla. Es importante que recordemos guardar el fichero Excel antes de refrescar todas las tablas.</para>
    </section>
    <section>
      <title>Repetimos los pasos 3 y 4 cuando haya nuevos datos disponibles en el servidor central</title>
      <para>Siempre que haya nuevos datos en el servidor repetiremos los pasos 3 y 4 (los últimos) para actualizar las tablas dinámicas y poder tener acceso a los datos más recientes.</para>
    </section>
  </section>
</chapter>
